{% extends "layout.html" %}
{% load forms_tags %}
{% load paginator_tags %}

{% block title %}Message Tester - {{ block.super }}{% endblock %}

{% block javascripts %}
{{ block.super }}
<script type="text/javascript">
	(function($) {
		$(function() {
			$("#id_text").keypress(function(ev) {
				if (ev.keyCode == 13 && !ev.shiftKey) {
					$(this).closest("form").submit();
					$("#id_submit").focus();
					ev.preventDefault();
				}
			}).focus();
		});
	})(jQuery);
</script>
{% endblock %}


{% block content %}
    <div class="span4">
        <h2>Message Tester</h2>
        <div>{# <-- without this div, the header overlays the top border of the form area #}
            <form action="" method="post" enctype="multipart/form-data">
                {% render_form message_form %}
                {% csrf_token %}

                <div class="form-actions">
                    <button type="submit" class="btn btn-primary" id="send-btn" name="send-btn">Send</button>
                    <label for="send-btn">Send single or multiple messages</label>
                    <button type="submit" class="btn btn-primary" id="clear-btn" name="clear-btn">Clear</button>
                    <label for="clear-btn">Clear saved messages to/from this phone number</label>
                    <button type="submit" class="btn btn-primary" id="clear-all-btn" name="clear-all-btn">Clear all</button>
                    <label for="clear-all-btn">Clear all saved messages</label>
                </div>
            </form>
        </div>
    </div>
    <div class="span8">
            <h2>Log</h2>
            <table id="log" class="sortable table table-striped table-bordered">
                <thead>
                <tr>
                    <th class="phone"><a href="">Phone Number</a></th>
                    <th class="text"><a href="">Message Text</a></th>
                </tr>
                </thead>
                <tbody>{% if message_log %}{% for msg in message_log %}
                    <tr class="{{ msg.direction }}">
                        {% spaceless %}
                        <td>
                            {% ifequal msg.direction "in" %}<span title="Incoming (You sent this message to RapidSMS)">{{ msg.identity }}&nbsp;&raquo;</span>{% endifequal %}
                            {% ifequal msg.direction "out" %}<span title="Outgoing (You received this message from RapidSMS)">{{ msg.identity }}&nbsp;&laquo;</span>{% endifequal %}
                        </td>
                        {% endspaceless %}
                        <td class="text">{{ msg.text }}</td>
                    </tr>{% endfor %}{% else %}{% if router_available %}
                    <tr class="no-data look-left">
                        <td colspan="2">
                            <p>
                                You haven't sent or received any test messages yet.<br />
                                Use the form on the left to get started.
                            </p>
                        </td>
                    </tr>{% else %}
                    <tr class="no-data error">
                        <td colspan="2">
                            <p>
                                The RapidSMS router could not be reached.<br />
                                Please check that it is running.
                            </p>
                        </td>
                    </tr>{% endif %}{% endif %}
                </tbody>
                <tfoot>
                <tr>
                    <td colspan="2">
                        {% paginator message_log %}
                    </td>
                </tr>
                </tfoot>
            </table>
    </div>
{% endblock %}
